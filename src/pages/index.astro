---
import SectionLabel from "@/components/SectionLabel.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { slugify } from "@/utils/formatting";
import SignInCodeBlock from "@/components/SignInCodeBlock.astro";
import SignInCard from "@/components/SignInCard.astro";
---

<BaseLayout>
  <header
    class="relative text-center py-10 sm:py-16 px-4 sm:px-8 border-b border-neutral-700"
  >
    <SectionLabel as="p">Intro</SectionLabel>
    <h1 class="text-sm text-neutral-400 font-mono">Alex Carpenter</h1>
    <p class="mt-2 font-medium text-xl sm:text-2xl text-balance tracking-tight">
      User Interface Engineer who enjoys working at the intersection of design
      and engineering teams.
    </p>
  </header>

  <section class="relative" id="currently">
    <SectionLabel>Currently</SectionLabel>
    <header class="relative p-4 sm:p-8">
      <p class="text-balance font-medium">
        Currently I am a part of the design team at <a
          href="https://clerk.com"
          class="underline decoration-2 decoration-neutral-600 hover:decoration-white"
          >Clerk</a
        > where I am working on <a
          href="https://clerk.com/docs/elements/overview"
          class="underline decoration-2 decoration-neutral-600 hover:decoration-white"
          >Elements</a
        > and rebuilding our <a
          href="https://clerk.com/docs/components/overview"
          class="underline decoration-2 decoration-neutral-600 hover:decoration-white"
          >UI Components</a
        >.
      </p>
    </header>

    <div
      class="border-y border-neutral-700 border-dashed grid grid-cols-1 sm:grid-cols-2 auto-rows-[20rem]"
    >
      <div
        class="relative sm:border-r border-dashed border-neutral-700 overflow-hidden"
      >
        <figure class="relative">
          <figcaption class="sr-only">TODO: Add description of code</figcaption>
          <div inert="">
            <SignInCodeBlock />
          </div>
        </figure>
      </div>

      <div class="max-sm:border-t border-dashed border-neutral-700">
        <div
          class:list={[
            "h-full relative overflow-hidden pt-8 px-4 sm:p-0 bg-neutral-900 [--clip-offset:0%]",
            // "sm:hover:[--clip-offset:100%]",
          ]}
        >
          <div
            class="relative sm:absolute mx-auto max-w-96 sm:min-w-full sm:translate-x-10 sm:translate-y-10"
          >
            <div
              class:list={[
                "absolute h-px border-t border-dashed border-neutral-700 -top-0.5",
                "w-screen left-1/2 right-1/2 ml-[-50vw] mr-[-50vw]",
              ]}
              aria-hidden="true"
            >
            </div>
            <div
              class="absolute h-full w-px -top-10 -left-0.5 bottom-0 border-l border-dashed border-neutral-700 cursor-ew-resize"
              aria-hidden="true"
            >
            </div>
            <div
              class="absolute h-full w-px -top-10 -right-0.5 bottom-0 border-r border-dashed border-neutral-700"
              aria-hidden="true"
            >
            </div>

            <SignInCard />
          </div>
        </div>
      </div>
    </div>
    <div class="p-4 sm:p-8 text-center">
      <p class="text-xs font-mono uppercase text-neutral-400">
        In collaboration with
      </p>
      <div class="flex justify-center mt-4">
        {
          [
            {
              name: "Joe Bell",
              img: "/img/joe-bell.jpeg",
              linkedin: "https://www.linkedin.com/in/joebell93/",
            },
            {
              name: "Bryce Kalow",
              img: "/img/bryce-kalow.jpeg",
              linkedin: "https://www.linkedin.com/in/bryce-kalow-86a57183/",
            },
            {
              name: "Tom Milewski",
              img: "/img/tom-milewski.jpeg",
              linkedin: "https://www.linkedin.com/in/tmilewski/",
            },
            {
              name: "Dylan Staley",
              img: "/img/dylan-staley.jpeg",
              linkedin: "https://www.linkedin.com/in/dstaley/",
            },
          ].map(({ name, img, linkedin }) => {
            const id = slugify(`tooltip-${name}`);
            return (
              <Fragment>
                <a
                  href={linkedin}
                  data-tooltip-trigger={id}
                  class="relative size-8 rounded-full -ml-0.5 ring-4 ring-neutral-950 grayscale hover:grayscale-0 overflow-hidden"
                  aria-describedby={id}
                >
                  <img
                    src={img}
                    alt={`${name} avatar`}
                    class="w-full h-full absolute object-cover"
                  />
                </a>
                <div
                  id={id}
                  role="tooltip"
                  class="bg-neutral-800 px-2 py-1 rounded-md text-xs font-mono w-max absolute top-0 left-0 hidden"
                >
                  {name}
                </div>
              </Fragment>
            );
          })
        }
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  import { computePosition, flip, shift, offset } from "@floating-ui/dom";

  const triggers = document.querySelectorAll(
    "[data-tooltip-trigger]"
  ) as NodeListOf<HTMLElement>;

  triggers.forEach((trigger) => {
    const content = document.getElementById(
      `${trigger.dataset.tooltipTrigger}`
    ) as HTMLElement;
    function update() {
      computePosition(trigger, content, {
        placement: "top",
        middleware: [
          offset(8),
          flip(),
          shift({
            padding: 16,
          }),
        ],
      }).then(({ x, y }) => {
        Object.assign(content.style, {
          left: `${x}px`,
          top: `${y}px`,
        });
      });
    }

    function show() {
      content.style.display = "block";
      update();
    }

    function hide() {
      content.style.display = "";
    }

    [
      ["mouseenter", show],
      ["mouseleave", hide],
      ["focus", show],
      ["blur", hide],
      [
        "keydown",
        (e: KeyboardEvent) => {
          if (e.key === "Escape") {
            hide();
          }
        },
      ],
    ].forEach(([event, listener]) => {
      trigger.addEventListener(
        event as keyof HTMLElementEventMap,
        listener as EventListenerOrEventListenerObject
      );
    });
  });
</script>
