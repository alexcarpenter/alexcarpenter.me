---
import { getCollection, render } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import ExternalLink from "@/components/ExternalLink.astro";

const rolodex = await getCollection("rolodex");
const renderedRolodex = await Promise.all(
  rolodex.map(async (item) => {
    const { Content } = await render(item);
    return { item, Content };
  }),
);
---

<BaseLayout
  title="Rolodex"
  description="A list of people I recommend connecting with."
>
  <header class="container mt-4">
    <span
      class="block max-w-[40ch] text-2xl leading-tight font-medium tracking-tight"
    >
      <h1 class="inline">Rolodex</h1>
    </span>
    <p class="text-muted-foreground mt-4 max-w-[55ch] font-medium text-pretty">
      I've been fortunate to work with some amazing people over the years.
      Here's a list of folks I recommend connecting with.
    </p>
  </header>

  <section class="container mt-16">
    <ul>
      {
        renderedRolodex
          .sort((a, b) => a.item.data.name.localeCompare(b.item.data.name))
          .map(({ item, Content }) => (
            <li class="border-separator mt-8 rounded-sm border-t pt-8">
              <article>
                <header class="flex items-center justify-between gap-4">
                  <div>
                    <h2 class="font-medium">{item.data.name}</h2>
                    <p class="text-muted-foreground font-medium">
                      {item.data.title}
                    </p>
                  </div>
                  <div>
                    <img
                      src={item.data.avatar}
                      alt={`Avatar for ${item.data.name}`}
                      class="size-12 rounded-md object-cover"
                    />
                  </div>
                </header>
                <div class="prose mt-4 text-pretty">
                  <Content />
                  {item.data.jobs ? (
                    <p class="text-muted-foreground">
                      As known from{" "}
                      {new Intl.ListFormat("en", {
                        style: "long",
                        type: "conjunction",
                      }).format(item.data.jobs) + "."}
                    </p>
                  ) : null}
                </div>
                {item.data.links && (
                  <ul class="mt-4 flex flex-wrap gap-x-4 gap-y-2">
                    {item.data.links?.twitter && (
                      <li>
                        <ExternalLink
                          href={item.data.links?.twitter}
                          text="Twitter"
                        />
                      </li>
                    )}
                    {item.data.links?.github && (
                      <li>
                        <ExternalLink
                          href={item.data.links?.github}
                          text="GitHub"
                        />
                      </li>
                    )}
                    {item.data.links?.linkedin && (
                      <li>
                        <ExternalLink
                          href={item.data.links?.linkedin}
                          text="LinkedIn"
                        />
                      </li>
                    )}
                    {item.data.links?.website && (
                      <li>
                        <ExternalLink
                          href={item.data.links?.website}
                          text="Website"
                        />
                      </li>
                    )}
                  </ul>
                )}
              </article>
            </li>
          ))
      }
    </ul>
  </section>
</BaseLayout>
