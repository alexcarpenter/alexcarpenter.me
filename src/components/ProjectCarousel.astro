---
import { Image } from "astro:assets";
interface Props {
  projects: Array<{
    img: {
      src: string;
      alt: string;
    };
    title: string;
    href: string;
  }>;
}
const { projects } = Astro.props;
// const renderCarousel = projects.length > 4;
const renderCarousel = false;
---

<div
  class:list={{
    embla: renderCarousel,
  }}
>
  <div class:list={[{ "overflow-hidden embla__viewport": renderCarousel }]}>
    <div
      class:list={[
        "flex -ml-2",
        {
          embla__container: renderCarousel,
        },
      ]}
    >
      {
        projects.map(({ img, href, title }) => {
          return (
            <div
              class:list={[
                "min-w-0 flex-[0_0_50%] sm:flex-[0_0_25%] pl-2",
                { embla__slide: renderCarousel },
              ]}
            >
              <a
                href={href}
                class="relative grid aspect-[3/2] overflow-hidden border border-subtle group"
              >
                <span class="sr-only">{title}</span>
                <Image
                  {...img}
                  width="960"
                  height="640"
                  class="absolute w-full h-full object-cover"
                />
                <span class="absolute bottom-2 right-2 bg-primary p-1 rounded-sm sm:opacity-0 group-hover:opacity-100 transition-opacity group-focus-visible:opacity-100">
                  <svg
                    viewBox="0 0 12 12"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    class="size-4 text-primary"
                    aria-hidden="true"
                  >
                    <path
                      d="M3.5 3C3.22386 3 3 3.22386 3 3.5C3 3.77614 3.22386 4 3.5 4V3ZM8.5 3.5H9C9 3.22386 8.77614 3 8.5 3V3.5ZM8 8.5C8 8.77614 8.22386 9 8.5 9C8.77614 9 9 8.77614 9 8.5H8ZM2.64645 8.64645C2.45118 8.84171 2.45118 9.15829 2.64645 9.35355C2.84171 9.54882 3.15829 9.54882 3.35355 9.35355L2.64645 8.64645ZM3.5 4H8.5V3H3.5V4ZM8 3.5V8.5H9V3.5H8ZM8.14645 3.14645L2.64645 8.64645L3.35355 9.35355L8.85355 3.85355L8.14645 3.14645Z"
                      fill="currentColor"
                    />
                  </svg>
                </span>
              </a>
            </div>
          );
        })
      }
    </div>
  </div>
  {
    renderCarousel ? (
      <div class="embla__progress relative mt-2 h-1 overflow-hidden bg-neutral-100  dark:bg-neutral-800">
        <div
          class="embla__progress__bar absolute top-0 bottom-0 w-full -left-full bg-neutral-500 dark:bg-neutral-400 "
          style="transform:translate3d(0%,0px,0px)"
        />
      </div>
    ) : null
  }
</div>

<script>
  import { options, setupProgressBar } from "@/utils/embla";
  import EmblaCarousel from "embla-carousel";
  const rootNodes = document.querySelectorAll(".embla");
  rootNodes.forEach((rootNode) => {
    const viewportNode = rootNode?.querySelector(
      ".embla__viewport"
    ) as HTMLElement;
    const progressNode = rootNode?.querySelector(
      ".embla__progress__bar"
    ) as HTMLElement;
    const emblaApi = EmblaCarousel(viewportNode, options);
    const { applyProgress, removeProgress } = setupProgressBar(
      emblaApi,
      progressNode
    );
    emblaApi
      .on("init", applyProgress)
      .on("reInit", applyProgress)
      .on("scroll", applyProgress)
      .on("destroy", removeProgress);
  });
</script>
